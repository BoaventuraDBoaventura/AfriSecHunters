import { useState, useEffect } from 'react';
import { Label } from '@/components/ui/label';
import { Input } from '@/components/ui/input';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { CreditCard, Phone, Mail, Building } from 'lucide-react';
import { PayoutMethod, PayoutDetails } from '@/types/database';

interface PayoutSettingsProps {
  payoutMethod: PayoutMethod | null;
  payoutDetails: PayoutDetails | null;
  onPayoutMethodChange: (method: PayoutMethod | null) => void;
  onPayoutDetailsChange: (details: PayoutDetails) => void;
}

export function PayoutSettings({
  payoutMethod,
  payoutDetails,
  onPayoutMethodChange,
  onPayoutDetailsChange,
}: PayoutSettingsProps) {
  const [details, setDetails] = useState<PayoutDetails>(payoutDetails || {});

  useEffect(() => {
    setDetails(payoutDetails || {});
  }, [payoutDetails]);

  const handleDetailChange = (key: keyof PayoutDetails, value: string) => {
    const newDetails = { ...details, [key]: value };
    setDetails(newDetails);
    onPayoutDetailsChange(newDetails);
  };

  return (
    <div className="space-y-4">
      <div className="flex items-center gap-2 mb-2">
        <CreditCard className="h-4 w-4 text-primary" />
        <Label>Método de Recebimento</Label>
      </div>
      
      <Select
        value={payoutMethod || ''}
        onValueChange={(value) => onPayoutMethodChange(value as PayoutMethod)}
      >
        <SelectTrigger className="bg-background border-border/50 focus:border-primary">
          <SelectValue placeholder="Selecione como deseja receber" />
        </SelectTrigger>
        <SelectContent>
          <SelectItem value="bank_transfer">
            <div className="flex items-center gap-2">
              <Building className="h-4 w-4" />
              Transferência Bancária
            </div>
          </SelectItem>
          <SelectItem value="mpesa">
            <div className="flex items-center gap-2">
              <Phone className="h-4 w-4" />
              M-Pesa
            </div>
          </SelectItem>
          <SelectItem value="paypal">
            <div className="flex items-center gap-2">
              <Mail className="h-4 w-4" />
              PayPal
            </div>
          </SelectItem>
        </SelectContent>
      </Select>

      {payoutMethod === 'bank_transfer' && (
        <div className="space-y-4 p-4 rounded-lg border border-border/50 bg-muted/20">
          <div className="space-y-2">
            <Label htmlFor="bank_name">Nome do Banco</Label>
            <Input
              id="bank_name"
              value={details.bank_name || ''}
              onChange={(e) => handleDetailChange('bank_name', e.target.value)}
              placeholder="Ex: BCI, Millennium BIM"
              className="bg-background border-border/50 focus:border-primary"
            />
          </div>
          <div className="space-y-2">
            <Label htmlFor="account_number">Número da Conta</Label>
            <Input
              id="account_number"
              value={details.account_number || ''}
              onChange={(e) => handleDetailChange('account_number', e.target.value)}
              placeholder="Número da conta bancária"
              className="bg-background border-border/50 focus:border-primary"
            />
          </div>
          <div className="space-y-2">
            <Label htmlFor="nib">NIB</Label>
            <Input
              id="nib"
              value={details.nib || ''}
              onChange={(e) => handleDetailChange('nib', e.target.value)}
              placeholder="Número de Identificação Bancária"
              className="bg-background border-border/50 focus:border-primary"
            />
          </div>
        </div>
      )}

      {payoutMethod === 'mpesa' && (
        <div className="space-y-4 p-4 rounded-lg border border-border/50 bg-muted/20">
          <div className="space-y-2">
            <Label htmlFor="phone_number" className="flex items-center gap-2">
              <Phone className="h-4 w-4" />
              Número M-Pesa
            </Label>
            <Input
              id="phone_number"
              value={details.phone_number || ''}
              onChange={(e) => handleDetailChange('phone_number', e.target.value)}
              placeholder="Ex: 84 123 4567"
              className="bg-background border-border/50 focus:border-primary"
            />
          </div>
        </div>
      )}

      {payoutMethod === 'paypal' && (
        <div className="space-y-4 p-4 rounded-lg border border-border/50 bg-muted/20">
          <div className="space-y-2">
            <Label htmlFor="paypal_email" className="flex items-center gap-2">
              <Mail className="h-4 w-4" />
              Email do PayPal
            </Label>
            <Input
              id="paypal_email"
              type="email"
              value={details.paypal_email || ''}
              onChange={(e) => handleDetailChange('paypal_email', e.target.value)}
              placeholder="seu-email@paypal.com"
              className="bg-background border-border/50 focus:border-primary"
            />
          </div>
        </div>
      )}

      {!payoutMethod && (
        <p className="text-sm text-muted-foreground">
          Configure como deseja receber seus pagamentos quando seus relatórios forem aprovados.
        </p>
      )}
    </div>
  );
}
